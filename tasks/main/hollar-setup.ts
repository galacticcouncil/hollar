import { task } from 'hardhat/config';
import {
  getACLManager,
  getPool,
  getPoolAddressesProvider,
  POOL_ADMIN,
} from '@galacticcouncil/aave-deploy-v3';
import { getBatch } from '@galacticcouncil/aave-deploy-v3/dist/helpers/transaction-batch';
import {
  location,
  aaveManagerCall,
  generateProposalV2,
  getApi,
  rootEvmCall,
} from '@galacticcouncil/aave-deploy-v3/dist/helpers/hydration-proposal';
import ProposalDecoder from '@galacticcouncil/aave-deploy-v3/dist/helpers/proposal-decoder';
import { GhoFlashMinter } from '../../types';
import { evmAddress } from '@galacticcouncil/aave-deploy-v3/dist/helpers/hydration-proposal';

task('hollar-setup', 'Deploy and Configure Hollar').setAction(async (params, hre) => {
  const { ethers } = hre;
  await hre.run('network-check');
  const admin = POOL_ADMIN[hre.network.name];

  console.log('DEPLOY CONTRACTS ########################################');
  const [_deployer] = await hre.ethers.getSigners();
  const deployerAddress = await _deployer.getAddress();
  if (deployerAddress === '0x71FeB8b2849101a6E62e3369eaAfDc6154CD0Bc0') {
    await hre.run('deploy', {
      tags: 'full_gho_deploy',
      noCompile: true,
    });
    await hre.run('print-all-deployments');
    console.log('transfer ownership to pool admin', admin);
    await hre.run('gho-transfer-ownership', { newOwner: admin });
    console.log('rest of the setup has to be done by admin');
    return;
  } else {
    console.log('admin cannot deploy contracts');
  }

  console.log('INITIALIZE RESERVE ######################################');
  await hre.run('initialize-gho-reserve', { batch: true });

  console.log('CONFIGURE RESERVE #######################################');
  await hre.run('enable-gho-borrowing', { batch: true });
  await hre.run('set-gho-oracle', { batch: true });

  console.log('CONFIGURE HOLLAR ########################################');
  await hre.run('add-gho-as-entity', { batch: true });
  await hre.run('add-gho-flashminter-as-entity', { batch: true });
  await hre.run('add-hsm-as-entity', { batch: true });
  await hre.run('set-gho-addresses', { batch: true });
  await hre.run('set-zero-discount-rate-strategy', { batch: true });

  const txs = await Promise.all(getBatch().map((tx) => aaveManagerCall({ ...tx, from: admin })));
  const txs2: any[] = [];

  const { tx, registry } = await getApi();
  txs.push(
    tx.assetRegistry.register(
      ...Object.values({
        id: '222',
        name: 'Hydrated Dollar',
        assetType: 'Erc20',
        existentialDeposit: 0,
        symbol: 'HOLLAR',
        decimals: 18,
        location: location((await ethers.getContract('GhoToken')).address),
        xcmRateLimit: null,
        isSufficient: true,
      })
    )
  );

  // register on assethub
  txs.push(
    registry.createType(
      'Call',
      '0x6b00040100041400040000000700e40b5402130000000700e40b540200060002286bee02000400383c000a0d0000e803000000900100140d0102040001010070617261f2070000000000000000000000000000000000000000000000000000'
    )
  );

  console.log('CREATE POOLS ########################################');
  const treasuryOrigin = { system: { Signed: '13UVJyLnbVp9RBZYFwFGyDvVd1y27Tt8tkntv6Q7JVPhFsTB' } };
  const hydrationTreasuryAddress = '0x6d6f646C70792f74727372790000000000000000';
  const pool = await getPool();
  const hollarAddress = (await ethers.getContract('GhoToken')).address;
  const mintAmount = ethers.utils.parseEther('1000001');
  const mint = await pool.populateTransaction.borrow(
    hollarAddress,
    mintAmount,
    2,
    0,
    hydrationTreasuryAddress,
    {
      gasLimit: 1_000_000,
    }
  );
  mint.from = hydrationTreasuryAddress;
  txs.push(await rootEvmCall(mint));

  console.log('HOLLAR-aUSDC');
  txs.push(
    tx.assetRegistry.register(
      ...Object.values({
        id: 110,
        name: '2-Pool-HUSDC',
        assetType: 'StableSwap',
        existentialDeposit: 1000,
        symbol: '2-Pool-HUSDC',
        decimals: 18,
        location: null,
        xcmRateLimit: null,
        isSufficient: true,
      })
    )
  );
  txs.push(
    tx.stableswap.createPool(
      ...Object.values({
        shareAsset: 110,
        assets: [222, 1003],
        amplification: 222,
        fee: 200,
      })
    )
  );
  txs2.push(
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.dispatcher.dispatchWithExtraGas(
        tx.stableswap.addAssetsLiquidity(
          110,
          [
            { assetId: 222, amount: '250,000,000,000,000,000,000,000'.replace(/,/g, '') },
            { assetId: 1003, amount: '250,000,000,000'.replace(/,/g, '') },
          ],
          1000
        ),
        1000000 // extra gas
      )
    )
  );

  console.log('HOLLAR-aUSDT');
  txs.push(
    tx.assetRegistry.register(
      ...Object.values({
        id: 111,
        name: '2-Pool-HUSDT',
        assetType: 'StableSwap',
        existentialDeposit: 1000,
        symbol: '2-Pool-HUSDT',
        decimals: 18,
        location: null,
        xcmRateLimit: null,
        isSufficient: true,
      })
    )
  );
  txs.push(
    tx.stableswap.createPool(
      ...Object.values({
        shareAsset: 111,
        assets: [222, 1002],
        amplification: 222,
        fee: 200,
      })
    )
  );
  txs2.push(
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.dispatcher.dispatchWithExtraGas(
        tx.stableswap.addAssetsLiquidity(
          111,
          [
            { assetId: 222, amount: '250,000,000,000,000,000,000,000'.replace(/,/g, '') },
            { assetId: 1002, amount: '250,000,000,000'.replace(/,/g, '') },
          ],
          1000
        ),
        1000000 // extra gas
      )
    )
  );

  console.log('HOLLAR-sUSDS');
  txs.push(
    tx.assetRegistry.register(
      ...Object.values({
        id: 112,
        name: '2-Pool-HUSDS',
        assetType: 'StableSwap',
        existentialDeposit: 1000,
        symbol: '2-Pool-HUSDS',
        decimals: 18,
        location: null,
        xcmRateLimit: null,
        isSufficient: true,
      })
    )
  );
  txs.push(
    tx.stableswap.createPoolWithPegs(
      ...Object.values({
        shareAsset: 112,
        assets: [222, 1_000_745],
        amplification: 111,
        fee: 400,
        pegSource: [{ Value: [1, 1] }, { MMOracle: '0x4b32bffc6acd751446e79e8687ef3815fd7924fd' }],
        maxPegUpdate: 1,
      })
    )
  );
  txs2.push(
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.stableswap.addAssetsLiquidity(
        112,
        [
          { assetId: 222, amount: '250,000,000,000,000,000,000,000'.replace(/,/g, '') },
          { assetId: 1_000_745, amount: '233,644,859,000,000,000,000,000'.replace(/,/g, '') },
        ],
        1000
      )
    )
  );

  console.log('HOLLAR-sUSDe');
  txs.push(
    tx.assetRegistry.register(
      ...Object.values({
        id: 113,
        name: '2-Pool-HUSDe',
        assetType: 'StableSwap',
        existentialDeposit: 1000,
        symbol: '2-Pool-HUSDe',
        decimals: 18,
        location: null,
        xcmRateLimit: null,
        isSufficient: true,
      })
    )
  );
  txs.push(
    tx.stableswap.createPoolWithPegs(
      ...Object.values({
        shareAsset: 113,
        assets: [222, 1_000_625],
        amplification: 111,
        fee: 400,
        pegSource: [{ Value: [1, 1] }, { MMOracle: '0x22cdea305cee63d082e79f8c5db939eecd0265d0' }],
        maxPegUpdate: 1,
      })
    )
  );
  txs2.push(
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.stableswap.addAssetsLiquidity(
        113,
        [
          { assetId: 222, amount: '250,000,000,000,000,000,000,000'.replace(/,/g, '') },
          { assetId: 1_000_625, amount: '208,333,333,000,000,000,000,000'.replace(/,/g, '') },
        ],
        1000
      )
    )
  );

  console.log('FUND HSM ########################################');
  const parseEther = (eth) => ethers.utils.parseEther(eth).toString();
  const max = parseEther('1111111');
  const coeficient = parseEther('0.995');
  const rate = 100000;
  const buyBackFee = 100;
  const purchaseFee = 0;
  const hsmTxs = [
    tx.hsm.addCollateralAsset(
      1003,
      110,
      purchaseFee,
      coeficient,
      buyBackFee,
      rate,
      500_000 * 10 ** 6
    ),
    tx.hsm.addCollateralAsset(
      1002,
      111,
      purchaseFee,
      coeficient,
      buyBackFee,
      rate,
      500_000 * 10 ** 6
    ),
    tx.hsm.addCollateralAsset(
      1_000_745,
      112,
      purchaseFee,
      coeficient,
      buyBackFee,
      rate,
      parseEther('250000')
    ),
    tx.hsm.addCollateralAsset(
      1_000_625,
      113,
      purchaseFee,
      coeficient,
      buyBackFee,
      rate,
      parseEther('250000')
    ),
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.utility.batchAll([
        tx.dispatcher.dispatchWithExtraGas(
          tx.hsm.buy(1003, 222, parseEther('100000'), max),
          1_000_000
        ),
        tx.dispatcher.dispatchWithExtraGas(
          tx.hsm.buy(1002, 222, parseEther('100000'), max),
          1_000_000
        ),
      ])
    ),
  ];

  const hsm2txs = [
    tx.utility.dispatchAs(
      treasuryOrigin,
      tx.utility.batchAll([
        tx.hsm.buy(1_000_745, 222, parseEther('50000'), max),
        tx.hsm.buy(1_000_625, 222, parseEther('50000'), max),
      ])
    ),
  ];

  const flashMinter = (await ethers.getContract('GhoFlashMinter')) as GhoFlashMinter;
  hsm2txs.push(tx.hsm.setFlashMinter(flashMinter.address));

  const hsmOrigin = {
    system: { Signed: '0x6d6f646c70792f68736d6f640000000000000000000000000000000000000000' },
  };
  const hsmAddress = '0x6d6f646c70792f68736d6f640000000000000000';

  hsm2txs.push(tx.utility.dispatchAs(hsmOrigin, tx.evmAccounts.bindEvmAddress()));

  const poolAddressesProvider = await getPoolAddressesProvider();
  const aclManager = await getACLManager(await poolAddressesProvider.getACLManager());
  const addFlashBorrower = await aclManager.populateTransaction.addFlashBorrower(hsmAddress);
  hsm2txs.push(await aaveManagerCall({ ...addFlashBorrower, from: admin }));

  const liquidationPalletAddress = await evmAddress(
    '13UVJyLmnf5GY7A8T9iVusvdwjMa2qVc2kpKmxpfuVK6T6jg'
  );
  const addLiquidationPalletFlashBorrower = await aclManager.populateTransaction.addFlashBorrower(
    liquidationPalletAddress
  );
  hsm2txs.push(await aaveManagerCall({ ...addLiquidationPalletFlashBorrower, from: admin }));

  hsm2txs.push(
    tx.multiTransactionPayment.addCurrency(222, '10,960,000,000,000,000,000,000'.replace(/,/g, ''))
  );

  hsm2txs.push(
    tx.router.forceInsertRoute({ assetIn: 0, assetOut: 222 }, [
      {
        pool: 'Omnipool',
        assetIn: '0',
        assetOut: '100',
      },
      {
        pool: {
          Stableswap: '100',
        },
        assetIn: '100',
        assetOut: '10',
      },
      {
        pool: 'Aave',
        assetIn: '10',
        assetOut: '1002',
      },
      {
        pool: {
          Stableswap: '111',
        },
        assetIn: '1002',
        assetOut: '222',
      },
    ])
  );

  hsm2txs.push(
    tx.router.forceInsertRoute({ assetIn: 20, assetOut: 222 }, [
      {
        pool: 'Omnipool',
        assetIn: '20',
        assetOut: '100',
      },
      {
        pool: {
          Stableswap: '100',
        },
        assetIn: '100',
        assetOut: '10',
      },
      {
        pool: {
          Stableswap: '102',
        },
        assetIn: '10',
        assetOut: '22',
      },
      {
        pool: 'Aave',
        assetIn: '22',
        assetOut: '1003',
      },
      {
        pool: {
          Stableswap: '110',
        },
        assetIn: '1003',
        assetOut: '222',
      },
    ])
  );

  console.log('INCENTIVES ###########################');
  const incentivesBatch = registry.createType(
    'Call',
    '0x0d027828015a01aa7e0000000000000000000000000000000aa7e0ad33c0f0c42c5a0eaa65b5895d2bdb20cb6e87601103abfd5310000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000006e000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000102737461626c657377000000de0000006e0000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4111102fb45e6000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c0df4c545bafa1788a4ee55f79704d12fc2c7b5c000000000000000000000000a5b223b3e1f19bff753e17c72073829010c4d339000000000000000000000000b7e516ba34a85b2fa554a63407df8a67f6f49a6c0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000fdb15f9fe2252044b08230449d4278cfd4df52e1000000000000000000000000000000000000000000000000000000010000006e000000000000000000000000e52567ff06acd6cbe7ba94dc777a3126e180b6d90000000000000000000000007472a3d0891df2401d981a5954d07e364f05060f00000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000001a4161766520487964726174656420322d504f4f4c2d48555344430000000000000000000000000000000000000000000000000000000000000000000000000015614879647261746564322d504f4f4c2d48555344430000000000000000000000000000000000000000000000000000000000000000000000000000000000002841617665204879647261746564205661726961626c65204465627420322d504f4f4c2d485553444300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000207661726961626c65446562744879647261746564322d504f4f4c2d485553444300000000000000000000000000000000000000000000000000000000000000264161766520487964726174656420537461626c65204465627420322d504f4f4c2d48555344430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e737461626c65446562744879647261746564322d504f4f4c2d48555344430000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0c62d00000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e087edc4e4071aa253c9b14c79305f48f3b9c16137910623bb1093000000000000000000000000e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000006e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e84800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4110126d2cec2000000000000000000000000000000000000000000000000000000010000006e00000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0ad33c0f0c42c5a0eaa65b5895d2bdb20cb6e87601103abfd5310000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000006f000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000102737461626c657377000000de0000006f0000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4111102fb45e6000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c0df4c545bafa1788a4ee55f79704d12fc2c7b5c000000000000000000000000a5b223b3e1f19bff753e17c72073829010c4d339000000000000000000000000b7e516ba34a85b2fa554a63407df8a67f6f49a6c0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000fdb15f9fe2252044b08230449d4278cfd4df52e1000000000000000000000000000000000000000000000000000000010000006f000000000000000000000000e52567ff06acd6cbe7ba94dc777a3126e180b6d90000000000000000000000007472a3d0891df2401d981a5954d07e364f05060f00000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000001a4161766520487964726174656420322d504f4f4c2d48555344540000000000000000000000000000000000000000000000000000000000000000000000000015614879647261746564322d504f4f4c2d48555344540000000000000000000000000000000000000000000000000000000000000000000000000000000000002841617665204879647261746564205661726961626c65204465627420322d504f4f4c2d485553445400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000207661726961626c65446562744879647261746564322d504f4f4c2d485553445400000000000000000000000000000000000000000000000000000000000000264161766520487964726174656420537461626c65204465627420322d504f4f4c2d48555344540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e737461626c65446562744879647261746564322d504f4f4c2d48555344540000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0c62d00000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e087edc4e4071aa253c9b14c79305f48f3b9c16137910623bb1093000000000000000000000000e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000006f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e84800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4110126d2cec2000000000000000000000000000000000000000000000000000000010000006f00000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0ad33c0f0c42c5a0eaa65b5895d2bdb20cb6e87601103abfd53100000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000100000070000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000102737461626c657377000000de000000700000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4111102fb45e6000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c0df4c545bafa1788a4ee55f79704d12fc2c7b5c000000000000000000000000a5b223b3e1f19bff753e17c72073829010c4d339000000000000000000000000b7e516ba34a85b2fa554a63407df8a67f6f49a6c0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000fdb15f9fe2252044b08230449d4278cfd4df52e10000000000000000000000000000000000000000000000000000000100000070000000000000000000000000e52567ff06acd6cbe7ba94dc777a3126e180b6d90000000000000000000000007472a3d0891df2401d981a5954d07e364f05060f00000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000001a4161766520487964726174656420322d504f4f4c2d48555344530000000000000000000000000000000000000000000000000000000000000000000000000015614879647261746564322d504f4f4c2d48555344530000000000000000000000000000000000000000000000000000000000000000000000000000000000002841617665204879647261746564205661726961626c65204465627420322d504f4f4c2d485553445300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000207661726961626c65446562744879647261746564322d504f4f4c2d485553445300000000000000000000000000000000000000000000000000000000000000264161766520487964726174656420537461626c65204465627420322d504f4f4c2d48555344530000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e737461626c65446562744879647261746564322d504f4f4c2d48555344530000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0c62d00000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e087edc4e4071aa253c9b14c79305f48f3b9c16137910623bb1093000000000000000000000000e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4110126d2cec2000000000000000000000000000000000000000000000000000000010000007000000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0ad33c0f0c42c5a0eaa65b5895d2bdb20cb6e87601103abfd53100000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000100000071000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000102737461626c657377000000de000000710000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4111102fb45e6000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c0df4c545bafa1788a4ee55f79704d12fc2c7b5c000000000000000000000000a5b223b3e1f19bff753e17c72073829010c4d339000000000000000000000000b7e516ba34a85b2fa554a63407df8a67f6f49a6c0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000fdb15f9fe2252044b08230449d4278cfd4df52e10000000000000000000000000000000000000000000000000000000100000071000000000000000000000000e52567ff06acd6cbe7ba94dc777a3126e180b6d90000000000000000000000007472a3d0891df2401d981a5954d07e364f05060f00000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000001a4161766520487964726174656420322d504f4f4c2d48555344450000000000000000000000000000000000000000000000000000000000000000000000000015614879647261746564322d504f4f4c2d48555344450000000000000000000000000000000000000000000000000000000000000000000000000000000000002841617665204879647261746564205661726961626c65204465627420322d504f4f4c2d485553444500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000207661726961626c65446562744879647261746564322d504f4f4c2d485553444500000000000000000000000000000000000000000000000000000000000000264161766520487964726174656420537461626c65204465627420322d504f4f4c2d48555344450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e737461626c65446562744879647261746564322d504f4f4c2d48555344450000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0c62d00000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e087edc4e4071aa253c9b14c79305f48f3b9c16137910623bb1093000000000000000000000000e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000010000007100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e0e64c38e2fa00dfe4f1d0b92f75b8e44ebdf292e4110126d2cec2000000000000000000000000000000000000000000000000000000010000007100000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000a0860100000000000046c323000000000000000000000000000000000000000000000000000000000000003300015604000001344879647261746564205553444305010080963d533d75000000000000000000011448555344430112010001030035774c305aaf441a102d47988d35f0f5428471b30001cb0156040000000018cdd610729c5e0200000000000043030000000056040000140300000000660000000266000000660000000a000000040a000000ea030000026e000000ea0300006e000000046e0000005604000033000157040000013c48796472617465642054657468657205010080963d533d7500000000000000000001144855534454011201000103001806860d27ee903c1ec7586d4f7d598d7591f1240001cb0157040000000018cdd610729c5e0200000000000043030000000057040000140300000000660000000266000000660000000a000000040a000000ea030000026f000000ea0300006f000000046f000000570400003300015804000001344879647261746564205553445305010080963d533d7500000000000000000001144855534453011201000103007e3ce0257506c3e1f96a2a9b25a9440959b0d4530001cb0158040000000018cdd610729c5e0200000000000043030000000058040000140300000000660000000266000000660000000a000000040a000000ea0300000270000000ea030000700000000470000000580400003300015904000001344879647261746564205553446505010080963d533d75000000000000000000011448555344650112010001030052e1311e26610e6662a1e5b5bd113130b68152130001cb0159040000000018cdd610729c5e0200000000000043030000000059040000140300000000660000000266000000660000000a000000040a000000ea0300000271000000ea0300007100000004710000005904000005040000000000000d021028015a01aa7e0000000000000000000000000000000aa7e008e8533cd99f96bd234d8734196285960c613e099104955c2ad7000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000002dcb7a4f14d4500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068f8e89e00000000000000000000000035774c305aaf441a102d47988d35f0f5428471b30000000000000000000000000000000000000000000000000000000100000045000000000000000000000000112c208b900bcfc9ff8131d0f45769cb6c7c7d8d000000000000000000000000edbd21f476039c6019d2ec3e97f949af98a5c1210000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e008e8533cd99f96bd234d8734196285960c613e099104955c2ad7000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000002dcb7a4f14d4500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068f8e89e0000000000000000000000001806860d27ee903c1ec7586d4f7d598d7591f1240000000000000000000000000000000000000000000000000000000100000045000000000000000000000000112c208b900bcfc9ff8131d0f45769cb6c7c7d8d000000000000000000000000edbd21f476039c6019d2ec3e97f949af98a5c1210000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e008e8533cd99f96bd234d8734196285960c613e099104955c2ad70000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000016e5bd278a6a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068f8e89e0000000000000000000000007e3ce0257506c3e1f96a2a9b25a9440959b0d4530000000000000000000000000000000000000000000000000000000100000045000000000000000000000000112c208b900bcfc9ff8131d0f45769cb6c7c7d8d000000000000000000000000edbd21f476039c6019d2ec3e97f949af98a5c1210000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000028015a01aa7e0000000000000000000000000000000aa7e008e8533cd99f96bd234d8734196285960c613e099104955c2ad70000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000016e5bd278a6a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068f8e89e00000000000000000000000052e1311e26610e6662a1e5b5bd113130b68152130000000000000000000000000000000000000000000000000000000100000045000000000000000000000000112c208b900bcfc9ff8131d0f45769cb6c7c7d8d000000000000000000000000edbd21f476039c6019d2ec3e97f949af98a5c1210000000000000000000000000000000000000000000000000000000000000000e0930400000000000046c3230000000000000000000000000000000000000000000000000000000000000005040100000000000d022c0d0301016d6f646c70792f7472737279000000000000000000000000000000000000000043046e000000560400000000000000000000000000000000000004046e000000560400000d0301016d6f646c70792f7472737279000000000000000000000000000000000000000042006d6f646c70792f7472737279000000000000000000000000000000000000000028000000000040683bb3f386f03400000000000001160001307500000156040000de0000000000d01309468e1501000000000000000000d01309468e1501000000000000000804560400006e000000026e0000006e000000de000000000d0301016d6f646c70792f7472737279000000000000000000000000000000000000000043046f000000570400000000000000000000000000000000000004046f000000570400000d0301016d6f646c70792f7472737279000000000000000000000000000000000000000042006d6f646c70792f7472737279000000000000000000000000000000000000000028000000000040683bb3f386f03400000000000001160001307500000157040000de0000000000d01309468e1501000000000000000000d01309468e1501000000000000000804570400006f000000026f0000006f000000de000000000d0301016d6f646c70792f747273727900000000000000000000000000000000000000004304700000005804000000000000000000000000000000000000040470000000580400000d0301016d6f646c70792f7472737279000000000000000000000000000000000000000042006d6f646c70792f7472737279000000000000000000000000000000000000000028000000000040683bb3f386f03400000000000001160001307500000158040000de0000000000d01309468e1501000000000000000000d01309468e15010000000000000008045804000070000000027000000070000000de000000000d0301016d6f646c70792f747273727900000000000000000000000000000000000000004304710000005904000000000000000000000000000000000000040471000000590400000d0301016d6f646c70792f7472737279000000000000000000000000000000000000000042006d6f646c70792f7472737279000000000000000000000000000000000000000028000000000040683bb3f386f03400000000000001160001307500000159040000de0000000000d01309468e1501000000000000000000d01309468e15010000000000000008045904000071000000027100000071000000de000000000504050000000158020000f4010000000d0301016d6f646c70792f747273727900000000000000000000000000000000000000005a016d6f646c70792f747273727900000000000000001b02e051683b5cfac5929c25e84adb26ecf87b381102573ade81000000000000000000000000531a654d1696ed52e7275a8cede955e82620f99a00000000000000000000000000000000000000000000006c6b935b8bbd40000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000006d6f646c70792f747273727900000000000000000000000000000000000000000000000000000000000000000000000000000000801a0600000000000046c3230000000000000000000000000000000000000000000000000000000000000005040c95040000000d0301016d6f646c70792f747273727900000000000000000000000000000000000000005a016d6f646c70792f747273727900000000000000001b02e051683b5cfac5929c25e84adb26ecf87b381102573ade81000000000000000000000000531a654d1696ed52e7275a8cede955e82620f99affffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000020000000000000000000000006d6f646c70792f747273727900000000000000000000000000000000000000000000000000000000000000000000000000000000801a0600000000000046c323000000000000000000000000000000000000000000000000000000000000000d0301016d6f646c70792f747273727900000000000000000000000000000000000000001d0068e108a3522672c9cd8674f8fb9a55449c917e86b00a9c318070a2e9a18896a8004f00112c208b900bcfc9ff8131d0f45769cb6c7c7d8d000000000000000000000000450000001b00002392ecd562c77e02'
  );

  txs.push(tx.scheduler.scheduleAfter(0, null, 0, tx.utility.batchAll(txs2)));
  txs.push(tx.scheduler.scheduleAfter(1, null, 0, tx.utility.batchAll(hsmTxs)));
  txs.push(tx.scheduler.scheduleAfter(2, null, 0, tx.utility.batchAll(hsm2txs)));
  txs.push(tx.scheduler.scheduleAfter(3, null, 0, incentivesBatch));

  let preimage = await generateProposalV2(txs, false);
  const decoder = new ProposalDecoder(hre);
  await decoder.init();
  console.log('submit preimages:');
  console.log(preimage.toHex());
  decoder.printTree(decoder.transformCall(preimage.toHuman()));
});
